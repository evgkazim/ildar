<!DOCTYPE html>
<html>
<head>
	<title>TEST</title>
	<meta chatset="utf-8">
	<style>
		div {
			padding: 5px;
		}
	</style>
</head>
<body>
	<div id="head">
		<h2>Оптимизация ИСБ</h2>
		<h4>Имя подсистемы</h4>
		<input id="add_sub_system_name" type="text">
		<button onclick="add_sub_system()">Добавить подсистему</button>
    </div>
	<div id=data></div>
	<div id=output>
		<div id=result></div>
		<button onclick="calc()">Расчитать</button>
	</div>
    <script>
		var id_sub_system = 0;
		
        function add_sub_system() {
			if(document.getElementById("add_sub_system_name").value.length == 0){
				alert("Enter a subsystem name!");
				return;
			}
			document.getElementById("data").innerHTML += 
			'<div id=' + id_sub_system + ' name=d0>' +
				'<label> Имя подсистемы: ' + document.getElementById("add_sub_system_name").value + '. Средства на оптимизацию </label>' +
				'<input id=' + id_sub_system + ' name="i1" type="number">' +
				'<button onclick="add_sub_sub_system(' + id_sub_system + ')">Добавить</button>' + 
				'<button onclick="del(this,true)">Удалить</button>' +
				'<div name="d1"></div>' +
			'</div>';
			id_sub_system++;
        }
		function add_sub_sub_system(id) {
			document.getElementById("data").children[id].children.d1.innerHTML += 
			'<div>' +
				'<label> ВБР </label><input id="a" type="text">' +
				'<label> количество </label><input id="b" type="text">' +
				'<label> стоимость </label><input id="c" type="text">' +
				'<button onclick="del(this,false)">Удалить</button>' +
			'</div>';
		}
		function del(id, is_sub) {
			if(is_sub) {
				id_sub_system--;
			}
			id.parentNode.parentNode.removeChild(id.parentNode);
		}
		
		function calc() {		
			var data = document.getElementById('data');
			for (var i = 0; i < data.childElementCount; i++) {
				var obj = {
					a:1, 
					b:0,
					c:0,
					d:[],
					p:0,
					w:0
				};
				
				var data_sub = data.children[i].children[4];
				for (var j = 0; j < data_sub.childElementCount; j++) {
					var sub = data_sub.children[j];
					obj.a *= Math.pow(sub.children[1].value, sub.children[3].value);
					obj.b += (sub.children[3].value * sub.children[5].value);
					obj.d.push({
						id:j,
						v1:parseFloat(sub.children[1].value),
						v2:parseInt(sub.children[3].value),
						v3:parseInt(sub.children[5].value),
						w1:(1 - Math.pow((1 - sub.children[1].value), 2)),
						w2:(1 - Math.pow((1 - sub.children[1].value), 2)) / sub.children[5].value
					});			
				}
				obj.c += parseInt(document.getElementById('data').children[i].children[1].value);
				obj.d.sort(function(a, b) {return b.w2 - a.w2;});
				console.log(obj);
				/*
				var s = obj.b + obj.c;
				while(s > obj.b) {
					
				}
				*/
			}
		}		
    </script>
</body>
</html>	